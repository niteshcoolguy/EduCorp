{% extends 'login_registration/base.html' %}

{% block content %}
<style>
    tbody, thead {
        color: white;
    }

    /* .mb-3 { */
        /* margin: 20px 0px; */
        /* margin-bottom: 20px; */
    /* } */

    table {
        margin-top: 20px;
    }

    .div1 {
        display: flex;
        justify-content: space-between;
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 60px;
        color: white;
    }

    .m-3 {
        width: 98%;
    }
    
</style>

<div class="m-3 table-responsive">
    <h2>Course List</h2>
    <div class="div1">
        <form method="GET">
            <div class="input-field">
                <input type="text" name="q" value="{{ query }}" placeholder="Search Here...">
                <button class="btn" type="submit" name="action" style="color: white;">Search</button>
            </div>
        </form>
        <div class="mb-3">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addCourseModal">
                <i class="fa fa-plus"></i> Add Course
            </button>
        </div>
    </div>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th style="text-align:center; width:3%" scope="col">#</th>
                <th style="text-align:center" scope="col">Course Name</th>
                <th style="text-align:center" scope="col">Course Description</th>
                <th style="text-align:center; width:8%" scope="col">Date</th>
                <th style="text-align:center; width:15%" scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for course in users %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{ course.course_name }}</td>
                <td>{{ course.course_description }}</td>
                <td style="text-align:center">{{ course.created_date|date:"d-m-y" }}</td>
                <td style="text-align:center">
                    <a class="m-1 btn btn-primary btn-sm" href="#" data-toggle="modal" data-target="#editCourseModal" 
                        data-id="{{ course.id }}" 
                        data-name="{{ course.course_name }}" 
                        data-description="{{ course.course_description }}"><i class="fa fa-edit"></i></a>
                    <a name="delete" class="m-1 btn btn-outline-danger btn-sm" href="#" data-url="{% url 'delete_course' course.id %}" data-toggle="modal" data-target="#deleteConfirmationModal"><i class="fa fa-trash"></i></a>
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if users.has_other_pages %}
    <ul class="pagination">
        {% if users.has_previous %}
        <li><a href="?page={{ users.previous_page_number }}">&laquo;</a></li>
        {% else %}
        <li class="disabled"><span>&laquo;</span></li>
        {% endif %}
        {% for i in users.paginator.page_range %}
        {% if users.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
        {% else %}
        <li><a href="?page={{ i }}">{{ i }}</a></li>
        {% endif %}
        {% endfor %}
        {% if users.has_next %}
        <li><a href="?page={{ users.next_page_number }}">&raquo;</a></li>
        {% else %}
        <li class="disabled"><span>&raquo;</span></li>
        {% endif %}
    </ul>
    {% endif %}
</div>

<!-- Add Course Modal -->
<div class="modal fade" id="addCourseModal" tabindex="-1" role="dialog" aria-labelledby="addCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background-color: grey;">
            <div class="modal-header">
                <h5 class="modal-title" id="addCourseModalLabel" style="color:white;">Create Course</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color:white;">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="createCourseForm" action="{% url 'create_course' %}" method="POST">
                    {% csrf_token %}
                    <div class="form-label-group">
                        <label for="title" style="color:white">Course Name</label>
                        <input type="text" id="title" name="title" class="form-control" placeholder="Enter your Course Name" required autofocus>
                    </div>
                    <br>
                    <div class="form-label-group">
                        <label for="task_content" style="color:white">Course Description</label>
                        <input type="text" id="task_content" class="form-control" name="task_content" placeholder="Enter your Course Description" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" form="createCourseForm" class="btn btn-primary">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Course Modal -->
<div class="modal fade" id="editCourseModal" tabindex="-1" role="dialog" aria-labelledby="editCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background-color: grey;">
            <div class="modal-header">
                <h5 class="modal-title" id="editCourseModalLabel" style="color:white;">Edit Course</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color:white;">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editCourseForm" method="POST">
                    {% csrf_token %}
                    <input type="hidden" id="edit-course-id" name="course_id">
                    <div class="form-label-group">
                        <label for="edit-title" style="color:white">Course Name</label>
                        <input type="text" id="edit-title" name="title" class="form-control" placeholder="Enter your Course Name" required>
                    </div>
                    <br>
                    <div class="form-label-group">
                        <label for="edit-description" style="color:white">Course Description</label>
                        <input type="text" id="edit-description" class="form-control" name="task_content" placeholder="Enter your Course Description" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" form="editCourseForm" class="btn btn-primary">Update</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background-color: grey;">
            <div class="modal-header" style="border-bottom: none;">
                <h5 class="modal-title" id="deleteConfirmationLabel" style="color:white;">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color:white;">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="color:white;">
                Are you sure you want to delete this course?
            </div>
            <div class="modal-footer" style="border-top: none;">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <a id="confirmDeleteBtn" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>


<script>
    $('#editCourseModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var id = button.data('id'); // Extract info from data-* attributes
        var name = button.data('name');
        var description = button.data('description');

        var modal = $(this);
        modal.find('.modal-body #edit-course-id').val(id);
        modal.find('.modal-body #edit-title').val(name);
        modal.find('.modal-body #edit-description').val(description);
        modal.find('form').attr('action', '/edit_course/' + id + '/'); // Adjust the form action URL
    });

    $('#deleteConfirmationModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var url = button.data('url'); // Extract the URL for deletion from data-* attribute

        var modal = $(this);
        modal.find('#confirmDeleteBtn').attr('href', url); // Set the href attribute for the confirm button
    });

    $('#editCourseModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var id = button.data('id'); // Extract info from data-* attributes
        var name = button.data('name');
        var description = button.data('description');

        var modal = $(this);
        modal.find('.modal-body #edit-course-id').val(id);
        modal.find('.modal-body #edit-title').val(name);
        modal.find('.modal-body #edit-description').val(description);
        modal.find('form').attr('action', '/edit_course/' + id + '/'); // Adjust the form action URL
    });
</script>

{% endblock %}
